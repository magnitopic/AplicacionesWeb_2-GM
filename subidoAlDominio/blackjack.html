<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/blackjack.css">
	<title>Black Jack</title>
</head>

<body>
	<div id="title">Juego del Black Jack</div>
	<div id="canvasDiv"><canvas id="canvas"></canvas></div>
	<div id="botones">
		<input type="button" value="Pedir Carta" onclick="pedirCarta()" id="pedir" class="button">
		<input type="button" value="Jugar otra vez!" id="reset" onclick="playagain()">
		<input type="button" value="Plantarme" onclick="plantarme()" id="plantar" class="button">
	</div>
	<div id="info"></div>
	<script>	
		// Codigo copiado para hacer esquinas redondas
		CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
			if (w < 2 * r) r = w / 2;
			if (h < 2 * r) r = h / 2;
			this.beginPath();
			this.moveTo(x + r, y);
			this.arcTo(x + w, y, x + w, y + h, r);
			this.arcTo(x + w, y + h, x, y + h, r);
			this.arcTo(x, y + h, x, y, r);
			this.arcTo(x, y, x + w, y, r);
			this.closePath();
			return this;
		}	
		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext("2d");

		class carta {
			static x = 10; // static pertenece a la clase
			static y = 10;
			constructor(x, y,valor,palo) {
				this.valor = valor
				this.palo=palo
			}
		}

		// Generamos las cartas. Con atributos valor y palo
		var cartas=[];
		var cartasJugador=[];
		var cartasCrupier=[];
		var indiceCarta=0;
		for (i=0; i<4;i++) {
			for (j=1; j<=13; j++) {
				cartas.push( new carta(10,10,j,i));
			}
		}

		//Barajamos las cartas
		for (i=0;i<100;i++){
			cartas.splice(Math.random()*52, 0, cartas[0]);
			cartas.shift();
		}
		console.log(cartas);

		function dibujarCartasJugador(cartaDibujar) {
			ctx.roundRect(carta.x, carta.y, 30, 50, 0).stroke();
			ctx.fillStyle = "white";
			ctx.fillRect(carta.x, carta.y, 30, 50);
			ctx.font = "20px TimesNewRoman";
			ctx.fillStyle = "black";
			ctx.fillText(cartaDibujar.valor, carta.x + 3, 40);
			carta.x+=40
		}

		function pedirCarta() {
			if (indiceCarta<52){
				cartasJugador.push(cartas[indiceCarta]);
				indiceCarta++;
				dibujarCartasJugador(cartas[indiceCarta]);
			}
		}

		function plantarme() {
			document.getElementById("pedir").disabled = true;
			document.getElementById("plantar").disabled = true;
			document.getElementById("reset").style.visibility= "visible";
			let pointsUser = 0;
			let pointsHouse = 0;
			let info=document.getElementById("info")
			for (i in cartasJugador) {
				pointsUser += cartasJugador[i].valor;
			}
			carta.desplazamiento = 0;
			while (pointsHouse < 17) {
				cartasCrupier.push(cartas[indiceCarta]);
				pointsHouse += cartas[indiceCarta].valor
				indiceCarta++;
			}
			info.innerHTML = "Puntuación jugador: " + pointsUser + "<br>Puntuación crupier: " + pointsHouse
			// Dibujamos las cartas del crupier
			carta.x=10
			carta.y=80
			for (i in cartasCrupier) {
				ctx.roundRect(carta.x, carta.y, 30, 50, 0).stroke();
				ctx.fillStyle = "white";
				ctx.fillRect(carta.x, carta.y, 30, 50);
				ctx.font = "20px TimesNewRoman";
				ctx.fillStyle = "black";
				ctx.fillText(cartasCrupier[i].valor, carta.x, carta.y + 30);
				carta.x+=40
			}
			// comprobamos ganador
			if (pointsUser>21){
				info.innerHTML += "<br><b>Has perdido por que te has pasado de puntos</b>"
			}else if (pointsHouse>21){
				info.innerHTML += "<br><b>Has ganado por que el croupier se ha pasado de puntos</b>"
			}else if (pointsHouse>=pointsUser){
				info.innerHTML += "<br><b>Ha ganado el croupier</b>"
			}else{
				info.innerHTML += "<br><b>Has ganado!!!</b>"
			}
		}


		function playagain(){
			location.reload(true);
		}
	</script>
</body>

</html>